# Visualise ACE Merkle Trees

It might be useful in some cases to visualise the Merkle tree generated by ACE. This document describes how to use the `visualise.sh` script to generate an ASCII representation of the tree built by ACE for a candidate table.

## Prerequisites

The `visualise.sh` script uses `astree` to render the tree structure. If `astree` is not found, it will print a raw indented list.

### 1. Install Rust

`astree` is a Rust crate, so you need to have Rust and its package manager, Cargo, installed. You can install them by running:

```sh
curl https://sh.rustup.rs -sSf | sh
```

### 2. Install astree

Once Cargo is installed, you can install `astree` with:

```sh
cargo install astree
```

For more info on `astree`, refer to [ascii_tree](https://github.com/yzhong52/ascii_tree).

## Usage

The `visualise.sh` script connects to a PostgreSQL database, queries the Merkle tree, and formats it for visualisation.

### Command Line Flags

The script accepts the following flags:

-   `-s <schema>`: The database schema. Defaults to `public`.
-   `-t <table>`: The table name (without the `ace_mtree_` prefix). This is **required**. The script will look for a table named `ace_mtree_<schema>_<table>`.
-   `-H <host>`: The database host.
-   `-U <user>`: The database user. Defaults to `admin` or the value of the `PGUSER` environment variable.
-   `-d <dbname>`: The database name. Defaults to `demo` or the value of the `PGDATABASE` environment variable.
-   `-h`: Render the tree horizontally.
-   `-v`: Render the tree vertically (default).

### Example

Here is an example of how to run the script:

```sh
PGUSER=admin PGDATABASE=demo ./visualise.sh -s public -t customers -H localhost -h
```

## Sample Output

```
ed292b
├─ e467ea
│  ├─ 5bdd5f
│  │  ├─ c3a797
│  │  │  ├─ [1 -> 1001] 3fc97d
│  │  │  └─ [1001 -> 2001] fc6eea
│  │  └─ 987ac8
│  │     ├─ [2001 -> 3001] eb7c40
│  │     └─ [3001 -> 4001] 730688
│  └─ bfbab5
│     ├─ 20b874
│     │  ├─ [4001 -> 5001] 724182
│     │  └─ [5001 -> 6001] 52f9f6
│     └─ 9f02c1
│        ├─ [6001 -> 7001] d22db1
│        └─ [7001 -> 8001] 4d2f70
└─ 094ec1
   └─ 094ec1
      ├─ eef7bf
      │  ├─ [8001 -> 9001] b6d3c3
      │  └─ [9001 -> 10000] 58247c
      └─ e7b97e
         └─ [10000 -> empty] e7b97e
```

Leaf nodes have the ranges they address along with a prefix of the hash. All other nodes just have the hash prefix.
